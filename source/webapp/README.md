# CONTENT ANALYSIS WEB APPLICATION

The Content Analysis web app provides a GUI for uploading videos, running workflows, and analyzing the metadata generated by said workflows. This README explains how to use it and how to run it.

![](/doc/images/MIEDemo.gif)

# USER'S GUIDE:

1. Upload videos in the upload button. Once the upload completes, it will automatically be processed with the MieComplete Workflow (i.e. the Kitchen sink) which includes every media analysis operator in MIE.
2. The workflow status will be shown in the Collection view. Status will be updated when you reload the page.
3. The search field in the Collection view searches the full metadata database in Elasticsearch. Everything you see in the analysis page is searchable. Even data that is excluded by the threshold you set in the Confidence slider is searchable. Search queries must use valid Lucene syntax.

## Sample Search Queries:

* Since Content Moderation returns a "Violence" label when it detects violence in a video, you can search for any video containing violence simply with: `Violence`
* Search for videos containing violence with a 80% confidence threshold: `Violence AND Confidence:>80` 
* The previous queries may match videos whose transcript contains the word "Violence". You can restrict your search to only Content Moderation results, like this: `Operator:content_moderation AND (Name:Violence AND Confidence:>80)`
* To search for Violence results in Content Moderation and guns or weapons identified by Label Detection, try this: `(Operator:content_moderation AND Name:Violence AND Confidence:>80) OR (Operator:label_detection AND (Name:Gun OR Name:Weapon))`  
* You can search for phrases in Comprehend results like this, `PhraseText:"some deep water" AND Confidence:>80`
* To see the full set of attributes that you can search for, click the Analytics menu item and search for "*" in the Discover tab of Kibana.

## Creating user accounts

You can give people access to the content analysis web app by creating an account for them in Amazon Cognito, like this:

1. Open the user pool for your MIE stack under Amazon Cognito
![](/doc/images/Cognito1-manage_user_pools.png)
2. Click the "Create user" button
![](/doc/images/Cognito2-create_user.png)
3. Specify the username and password then click the "Create user" button
![](/doc/images/Cognito3-set_password.png)
4. Open the user you just created
![](/doc/images/Cognito4-edit_user.png)
5. Add the user to the "MIEDevelopersGroup" 
![](/doc/images/Cognito5-add_to_group.png)

Now that user should be able to use the MIE content analysis application.

# COST:

Most AWS accounts include a free tier for the services used in MIE. However, if your usage exceeds the free tier allotments then you will be responsible for the cost of the AWS services used while running MIE.

The cost of this app is dominated by AWS Rekognition and Amazon Elasticsearch. A good rule of thumb is that videos will cost about $0.50 / minute to process. That can vary between $0.10 / minute and $0.60 / minute depending on video content. If you disable Rekognition in your workflow configuration then these costs will be more like $0.04 / minute. Data storage will generally be $10/day regardless of the quantity or type of video content. 

While the costs of processing a video occurs as a one-time expense after uploading the video, the costs for data storage occur daily, as shown in the following screenshot from AWS Cost Explorer:

![](/doc/images/costs_movie.png)

# DEVELOPERS:

Join our Gitter chat at [https://gitter.im/awslabs/aws-media-insights-engine](https://gitter.im/awslabs/aws-media-insights-engine). This public chat forum was created to foster communication between MIE developers worldwide.

[![Gitter chat](https://badges.gitter.im/gitterHQ/gitter.png)](https://gitter.im/awslabs/aws-media-insights-engine)

## Running a Development Environment:

Here's how to run the web app on an Amazon Linux Docker container:

### Start an Amazon Linux container
```
docker run -it amazonlinux
yum groupinstall "Development Tools" -y
```

### Install npm
```
cd /root
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.34.0/install.sh | bash
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
. .nvm/nvm.sh
nvm install --latest-npm
```

### Download MIE 
```
git clone ssh://git.amazon.com/pkg/MediaInsightsEngine
```

### Install the packages in package.json
```
cd MediaInsightsEngine/webapp
npm install
```

### Define the following environment variables in `webapp/public/runtimeConfig.json`:
These values will be in your CloudFormation stack once you've deployed MIE in your AWS account. 
* ELASTICSEARCH_ENDPOINT
* WORKFLOW_API_ENDPOINT
* DATAPLANE_API_ENDPOINT
* DATAPLANE_BUCKET
* USER_POOL_ID
* USER_POOL_CLIENT_ID
* IDENTITY_POOL_ID
* AWS_REGION


### Run with hot-reload for development:
```
npm run serve
```

Note, hot-reload won't work when webpack-subresource-integrity is enabled. To disable it, set the `enabled` property for the SriPlugin to false in `vue.config.js`.  
